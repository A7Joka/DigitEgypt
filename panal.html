f<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Ù…ÙˆÙ„Ø¯ ÙƒÙˆØ¯ JokaMatch</title>
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #151825;
      color: #fff;
      padding: 30px;
      direction: rtl;
    }

    .container {
      max-width: 800px;
      margin: auto;
    }

    input, textarea, button, select {
      font-family: inherit;
      border: none;
      border-radius: 8px;
      padding: 10px;
    }

    input, textarea, select {
      background: #1e2133;
      color: #fff;
    }

    button {
      background: #39DBBF;
      cursor: pointer;
      font-weight: bold;
    }

    .hidden {
      display: none;
    }

    .match-wrapper {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      margin-bottom: 15px;
    }

    .match-checkbox {
      margin-top: 6px;
    }

    .inline-match-item {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      background: rgba(255,255,255,0.05);
      border: 1px solid #2e3247;
      border-radius: 10px;
      padding: 12px;
      color: var(--text, #BFC3D4);
      position: relative;
    }

    .team-block {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }

    .team-block img {
      width: 28px;
      height: 28px;
      border-radius: 50%;
    }

    .match-x {
      font-weight: bold;
      font-size: 16px;
      margin: 0 10px;
    }

    .cup-title {
      width: 100%;
      text-align: center;
      font-size: 13px;
      font-weight: bold;
      margin-bottom: 6px;
    }

    .input-link {
      width: 100%;
      margin-top: 10px;
    }

    #finalCode {
      width: 100%;
      background: #1e2133;
      padding: 15px;
      margin-top: 20px;
      border-radius: 8px;
      direction: ltr;
      font-size: 14px;
      resize: none;
    }
    .section-title {
  padding: 0 15px;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.matches-date-filter {
  display: flex;
  align-items: center;
  gap: 10px;
}
.date-next-prev {
  background: #1e2133;
  color: #fff;
  border: none;
  border-radius: 6px;
  width: 30px;
  height: 30px;
  font-size: 18px;
  cursor: pointer;
}
.filtered-date {
  font-weight: bold;
  font-size: 14px;
  color: #39DBBF;
}
.toast {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #333;
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .toast.show { opacity: 1; }
    .section-title {
  padding: 0 15px;
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.section-actions {
  display: flex;
  align-items: center;
  gap: 10px;
}

.matches-date-filter {
  display: flex;
  align-items: center;
  gap: 15px;
}

.inline-date-filter {
  display: flex;
  align-items: center;
  gap: 10px;
}

.date-next-prev {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 4px;
  display: flex;
  align-items: center;
}

.filtered-date {
  font-weight: bold;
  font-size: 14px;
  color: #39DBBF;
  min-width: 110px;
  text-align: center;
}

.match-filter-date-wrapper {
  position: relative;
}

.date-picker-toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #1e2133;
  border-radius: 6px;
  width: 30px;
  height: 30px;
  cursor: pointer;
}

.date-picker-toggle svg {
  pointer-events: none;
}

#real-date-picker {
  position: absolute;
  top: 35px;
  right: 0;
  background: #1e2133;
  color: white;}
    .filtered-date {
  font-weight: bold;
  font-size: 14px;
  color: #39DBBF;
  min-width: 110px;
  text-align: center;
}
.date-picker-toggle {
  display: flex;
  align-items: center;
  justify-content: center;
  background: #1e2133;
  border-radius: 6px;
  width: 30px;
  height: 30px;
  cursor: pointer;
}@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
      }
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Tajawal:wght@400;700&display=swap');

.login-form-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background: #151825;
  font-family: 'Tajawal', 'Cairo', sans-serif;
}

.login-card {
  background: #1e2133;
  padding: 30px 25px;
  border-radius: 12px;
  box-shadow: 0 0 12px #0a0d3722;
  max-width: 350px;
  width: 100%;
  text-align: center;
  color: #fff;
}

.login-card input {
  width: 100%;
  padding: 14px 12px;
  margin-bottom: 15px;
  border-radius: 8px;
  background: #151825;
  border: 2px solid #2e3247;
  color: #fff;
  font-size: 14px;
}

.login-card input:focus {
  border-color: #39DBBF;
  outline: none;
}

.login-btn {
  background-color: #39DBBF;
  color: #fff;
  border: none;
  border-radius: 8px;
  padding: 12px;
  font-size: 16px;
  width: 100%;
  cursor: pointer;
  transition: background 0.3s ease;
}

.login-btn:hover {
  background-color: #2cc3a5;
}

.login-help {
  margin-top: 15px;
  font-size: 13px;
  opacity: 0.8;
  line-height: 1.6;
}

.login-help a {
  color: #39DBBF;
  text-decoration: none;
  font-weight: bold;
}
  </style>
</head>
<body>
  <div class="container">
<div id="login-area">
 <div class="login-form-container">
  <div class="login-card">
    <h2 style="margin-bottom: 20px;">ğŸ› ï¸ Ø£Ø¯Ø§Ø© ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ JokaMatch</h2>
    <div>
      <input class="Email" type="text" id="loginEmail" placeholder="Email@gmail.com">
      <input class="Password" type="password" id="loginPassword" placeholder="Password">
      <button onclick="login()" class="login-btn">ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    </div>
    <div class="login-help">
      <p>Ø¥Ø°Ø§ ÙƒÙ†Øª Ø¹Ù…ÙŠÙ„Ø§Ù‹ Ù„Ø¯ÙŠÙ†Ø§ØŒ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„.</p>
      <a href="https://wa.me/+201030588214" target="_blank" rel="nofollow noopener">ğŸ’¬ ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</a>
    </div>
  </div>
</div>
  </div>
    <div id="generator-area" class="hidden">
      <h2>ğŸ› ï¸ Ø£Ø¯Ø§Ø© ØªÙˆÙ„ÙŠØ¯ ÙƒÙˆØ¯ JokaMatch</h2>
      <input type="text" id="apiKeyInput" style="width:48%" placeholder="API Key">
      <select id="flt" style="width:24%">
      <option value="1">Grouped</option>
      <option value="2">Categorized</option>
    </select>
    <select id="theme" style="width:24%">
      <option value="dark">Dark</option>
      <option value="light">Light</option>
    </select>

      <div id="matches-area" class="hidden">
<div class="section-title">
  <h3>ğŸ“… Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</h3>
  <div class="section-actions">
    <div class="matches-date-filter">
      <div class="inline-date-filter">
        <a href="javascript:void(0)" id="prev-date" class="date-next-prev">
          <svg xmlns="http://www.w3.org/2000/svg" width="5" height="8.75" viewBox="0 0 5 8.75">
            <path d="M3.491,4.375.183,7.683a.625.625,0,0,0,.884.884l3.75-3.75a.625.625,0,0,0,0-.884L1.067.183a.625.625,0,0,0-.884.884Z" fill="#bfc3d4"/>
          </svg>
        </a>
        <span id="displayed-date" class="filtered-date">--</span>
        <a href="javascript:void(0)" id="next-date" class="date-next-prev">
          <svg xmlns="http://www.w3.org/2000/svg" width="5" height="8.75" viewBox="0 0 5 8.75">
            <path d="M3.491,4.375.183,7.683a.625.625,0,0,0,.884.884l3.75-3.75a.625.625,0,0,0,0-.884L1.067.183a.625.625,0,0,0-.884.884Z" transform="rotate(180 2.5 4.375)" fill="#bfc3d4"/>
          </svg>
        </a>
      </div>

      <div class="match-filter-date-wrapper">
        <a href="javascript:void(0)" class="date-picker-toggle" onclick="toggleDatePicker()">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="20" viewBox="0 0 18 20">
            <path d="M2.7,20A2.716,2.716,0,0,1,0,17.273V4.546A2.717,2.717,0,0,1,2.7,1.818H4.5V.909a.9.9,0,1,1,1.8,0v.909h5.4V.909a.9.9,0,1,1,1.8,0v.909h1.8A2.717,2.717,0,0,1,18,4.546V17.273A2.716,2.716,0,0,1,15.3,20Zm-.9-2.727a.905.905,0,0,0,.9.909H15.3a.905.905,0,0,0,.9-.909V9.091H1.8Zm14.4-10V4.546a.906.906,0,0,0-.9-.91H13.5v.91a.9.9,0,1,1-1.8,0v-.91H6.3v.91a.9.9,0,1,1-1.8,0v-.91H2.7a.906.906,0,0,0-.9.91V7.273Z" fill="#707488"/>
          </svg>
        </a>
        <input type="date" id="real-date-picker" onchange="handleDateChangeByPicker()" style="position:absolute; opacity:0; width:1px; height:1px; pointer-events:none;">
      </div>
    </div>
  </div>
</div>
<div class="championship-wrap important-matches">
  <div id="matchCounter" style="margin-bottom: 16px; font-size: 14px; color:#ccc;"></div>
</div>

        <h3>ğŸ‘‡ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙˆØ­Ø¯Ø¯ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø®ØµØµØ© Ù„ÙƒÙ„ ÙˆØ§Ø­Ø¯Ø©</h3>
        <div id="match-list"></div>
        <div id="counter" style="display: inline-block;margin-bottom:10px;font-size:14px;width:59%"></div>
        <button id="generate-btn" style="width:20%">âš™ï¸ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ÙƒÙˆØ¯</button>
        <button onclick="resetAll()" style="width:20%;background:#ff5252">â™»ï¸ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙƒÙ„</button>
        


        <div style="position: relative;">
          <textarea id="finalCode" style="width:97%" rows="6" readonly onclick="this.select();"></textarea>
          <button onclick="copyCode()" style="position:absolute; bottom:10px; left:10px;">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯</button>
        </div>
      </div>
    </div>
  </div>
<div id="loading-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#151825dd; z-index:9999; align-items:center; justify-content:center;">
  <div class="spinner" style="border: 4px solid #2e3247; border-top: 4px solid #39DBBF; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;"></div>
</div>
<div class="toast" id="toast"></div>
  <script>
function showToast(msg) {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.classList.add("show");
  setTimeout(() => toast.classList.remove("show"), 2500);
}
    function renderMatches(matches) {
  const list = document.getElementById("match-list");
  list.innerHTML = "";
  document.getElementById("matches-area").classList.remove("hidden");

  matches.forEach(match => {
    const matchId = match["Match-id"];
    const cup = match["Cup-Name"] || "Ø¨Ø·ÙˆÙ„Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©";
    const right = match["Team-Right"];
    const left = match["Team-Left"];

    const wrapper = document.createElement("div");
    wrapper.className = "match-wrapper";
    wrapper.dataset.id = matchId;

    wrapper.innerHTML = `
      <div class="match-checkbox">
        <input type="checkbox" id="chk-${matchId}" onchange="toggleInput('${matchId}')">
      </div>
      <div class="inline-match-item">
        <div class="cup-title">ğŸ† ${cup}</div>
        <div class="team-block"><img src="${right.Logo}"><span>${right.Name}</span></div>
        <div class="match-x">X</div>
        <div class="team-block"><span>${left.Name}</span><img src="${left.Logo}"></div>
        <div class="input-link hidden" id="card-${matchId}">
          <input type="text" style="width:97%" id="link-${matchId}" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©">
        </div>
      </div>
    `;
    list.appendChild(wrapper);
  });
  updateCounter();
}
async function generateSignature(str) {
  const buffer = new TextEncoder().encode(str);
  const digest = await crypto.subtle.digest("SHA-256", buffer);
  return [...new Uint8Array(digest)].map(b => b.toString(16).padStart(2, "0")).join("");
}

let isFetching = false;

async function fetchMatches(day) {
  if (isFetching) return;
  isFetching = true;
const loading = document.getElementById("loading-overlay");
  loading.style.display = "flex"; 
  const SECRET = "NinJ0kaKey";
  const ts = Math.floor(Date.now() / 1000);
  const sig = await generateSignature(`${ts}:${SECRET}`);
  const proxyUrl = `https://joka.ninjoka.workers.dev/?ts=${ts}&sig=${sig}&date=${encodeURIComponent(day)}`;

  try {
    const res = await fetch(proxyUrl, {
      headers: { "X-From-Joka": "YES" }
    });
    const rawText = await res.text();

    if (!rawText.startsWith("NinJoka(")) {
      showToast("â›” Ø§Ù„Ø±Ø¯ ØºÙŠØ± Ù…ØµØ±Ø­ Ø¨Ù‡ Ø£Ùˆ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ Ù…ÙƒØ±Ø±\n\n" + rawText);
      throw new Error("â›” Ø§Ù„Ø±Ø¯ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹");
    }

    const json = JSON.parse(rawText.replace(/^NinJoka\((.*)\)$/, "$1"));
    if (!json.matches || !Array.isArray(json.matches)) throw new Error("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨Ø§Ø±ÙŠØ§Øª");

    matches = json.matches;
    renderMatches(matches);
  } catch (e) {
    showToast("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª");
    console.error(e);
  } finally {
    isFetching = false;
    loading.style.display = "none";
  }
  }
async function login() {
  const email = document.getElementById("loginEmail").value.trim().toLowerCase();
  const pass = document.getElementById("loginPassword").value.trim();
  const btn = document.querySelector(".login-btn");

  if (!email || !pass) return showToast("ğŸ“› Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");

  btn.disabled = true;
  btn.textContent = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...";

  try {
    const res = await fetch("https://eng3body0.github.io/DigitEgypt/users.js");
    const encoded = await res.text();
    const decoded = atob(encoded);
    const users = JSON.parse(decoded);

    const user = users.find(u => u.email === email && u.password === pass);
    if (!user) {
      showToast("âŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    } else {
      document.getElementById("login-area").classList.add("hidden");
      document.getElementById("generator-area").classList.remove("hidden");
      document.getElementById("apiKeyInput").value = user.apiKey;
      fetchMatches("today");
    }
  } catch (e) {
    console.error(e);
    showToast("âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚");
  } finally {
    setTimeout(() => {
      btn.disabled = false;
      btn.textContent = "ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
    }, 3000);
  }
}
// Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ 3 Ø«ÙˆØ§Ù†Ù 
function resetAll() {
  matches.forEach(match => {
    const id = match["Match-id"];
    document.getElementById(`chk-${id}`).checked = false;
    toggleInput(id);
  });
  document.getElementById("finalCode").value = "";
}
function generateCode() {
  const map = {};
  document.querySelectorAll(".match-wrapper").forEach(wrapper => {
    const id = wrapper.dataset.id;
    const chk = document.getElementById(`chk-${id}`);
    const input = document.getElementById(`link-${id}`);
    map[id] = chk.checked ? (input.value.trim() || "#") : "--hide--";
  });

  const json = JSON.stringify(map);
  const encoded = btoa(json);
  const apiKey = document.getElementById("apiKeyInput").value.trim();
  const flt = document.getElementById("flt").value;
  const theme = document.getElementById("theme").value;

  const final = [
    "<JokaMatch>",
    `<div day="today" theme="${theme}" flt="${flt}" data-links="${encoded}" style="display:block;text-align:center;"></div>`,
    "</JokaMatch>",
    `<script src="https://eng3body0.github.io/DigitEgypt/tm.js" api-key="${apiKey}"><\/script>`
  ].join("\n");

  document.getElementById("finalCode").value = final;
}

function copyCode() {
  const txt = document.getElementById("finalCode").value;
  navigator.clipboard.writeText(txt).then(() => {
    showToast("ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ âœ…");
  });
function toggleInput(id) {
  const inputBox = document.getElementById(`card-${id}`);
  const chk = document.getElementById(`chk-${id}`);
  inputBox.classList.toggle("hidden", !chk.checked);
    updateCounter();
}

// Ø£ÙˆÙ„ Ù…Ø±Ø©
    let currentDate = new Date();

updateDateDisplay();
function updateCounter() {
  const total = matches.length;
  const selected = document.querySelectorAll("input[type='checkbox']:checked").length;
  document.getElementById("counter").textContent = `âœ… ØªÙ… ØªØ­Ø¯ÙŠØ¯ ${selected} Ù…Ù† Ø£ØµÙ„ ${total}`;
}

function updateDateDisplay() {
  const options = { day: "numeric", month: "long", year: "numeric" };
  document.getElementById("displayed-date").textContent = currentDate.toLocaleDateString("ar-EG", options);
  document.getElementById("displayed-date").dataset.date = currentDate.toISOString().split("T")[0];
  document.getElementById("real-date-picker").value = currentDate.toISOString().split("T")[0];
}

function loadMatchesByDate() {
  const formatted = currentDate.toISOString().split("T")[0];
  fetchMatches(formatted);
}

function toggleDatePicker() {
  const picker = document.getElementById("real-date-picker");
  picker.showPicker(); // âœ… ÙŠØ¯Ø¹Ù… Ù…Ø¹Ø¸Ù… Ø§Ù„Ù…ØªØµÙØ­Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©
}

function handleDateChangeByPicker() {
  const picker = document.getElementById("real-date-picker");
  const val = picker.value;
  if (val) {
    currentDate = new Date(val);
    updateDateDisplay();
    loadMatchesByDate();
  }
}

document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("prev-date").addEventListener("click", () => {
    currentDate.setDate(currentDate.getDate() - 1);
    updateDateDisplay();
    loadMatchesByDate();
  });

  document.getElementById("next-date").addEventListener("click", () => {
    currentDate.setDate(currentDate.getDate() + 1);
    updateDateDisplay();
    loadMatchesByDate();
  });

  document.getElementById("real-date-picker").addEventListener("change", handleDateChangeByPicker);

  updateDateDisplay();
});
}
</script>
</body>
</html>
